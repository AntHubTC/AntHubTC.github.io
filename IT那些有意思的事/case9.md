# ä¸ºä»€ä¹ˆå¯¼å‡ºçš„æŠ¥å‘Šå›¾ç‰‡æ˜¯å€’ç€çš„ï¼Ÿ



![image-20240923175056720](img/case9/image-20240923175056720.png)





:question::question::question::question::question::question::question::question:ğŸ¤”ğŸ¤”ğŸ¤”ğŸ¤”ğŸ¤”ğŸ¤”ğŸ¤”ğŸ¤”ğŸ¤”ä¸ºå•¥ï¼Ÿ

é€šè¿‡æ•°æ®åº“å°†urlè¿˜åŸå‡ºæ¥ï¼Œä½¿ç”¨htmlæ„å»ºå‡ºæ¥çœ‹ï¼Œç»“æœæ²¡æœ‰é—®é¢˜ã€‚

```html
<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <style>
        body > div {
            overflow-y: auto;
        }
        img{
            width: 100px;

            display: inline-block;
            border: 1px solid black;
        }
    </style>
</head>
<body>
        <div>
            <img src="https://zhl-rm-pro.obs.cn-east-2.myhuaweicloud.com/mk-crm/Bæ ‹1å•å…ƒä¸­1ä¸€å·ç‰ˆä½_SZA-D05-081-K1-da423668ad63424d85665c2c9befb28a.jpg"/>
            <img src="https://zhl-rm-pro.obs.cn-east-2.myhuaweicloud.com/mk-crm/Aæ ‹1å•å…ƒå·¦1ä¸‰å·ç‰ˆä½_SZA-D87-001-K3-cc6f9b7b7e8b4622a4a7e3e59852425e.jpg"/>
            <img src="https://zhl-rm-pro.obs.cn-east-2.myhuaweicloud.com/mk-crm/Bæ ‹1å•å…ƒå·¦2äºŒå·ç‰ˆä½_SZA-D05-082-K2-32dfab60310c4bb7876fc4d371b3f1ac.jpg"/>
        </div>
</body>
</html>
```

![image-20240923180022029](img/case9/image-20240923180022029.png)



:question::question::question::question:è®©æµ‹è¯•äººå‘˜å¤ç°ï¼Œé¦–æ¬¡æ²¡æœ‰å¤ç°å¤„ç†æ¥ã€‚

:question::question::question::question:æ’æŸ¥äº†å¾ˆä¹…ï¼Œæ²¡å‘ç°å•¥é—®é¢˜ï¼Œåæ¥äº§å“å¯¼å‡ºæ¥è¯´åˆå¯ä»¥äº†ï¼Œæ‰€ä»¥åæ¥å°±æ²¡ç®¡äº†ã€‚

:question::question::question::question:æˆ‘ä»¬æ€€ç–‘æ˜¯ç”¨æˆ·å·å·å°†ç…§ç‰‡é‡æ–°ä¼ æ­£äº†ï¼Œç…§ç‰‡è‚¯å®šæ‹å‡ºæ¥å°±æ˜¯é‚£æ ·çš„ã€‚



æè¿°çš„å¾ˆç®€å•ï¼Œè¿‡ç¨‹ä¸­çœŸçš„æ›²æŠ˜ï¼ŒèŠ±äº†å¤§åŠ›æ°”å»æ’æŸ¥ï¼ŒåŒ…æ‹¬æ¢åŒ…çš„ç‰ˆæœ¬éƒ½è¯•è¿‡ï¼Œè¿˜æ˜¯ä¸è¡Œï¼ŒåŠ ä¸Šæˆ‘ä»¬ç»„æ¥è¿‡èåª’è¿™ä¸ªç³»ç»Ÿï¼Œä¸€ç‚¹ç‚¹éƒ½ä¸ç†Ÿæ‚‰ä»–ä»¬ä¹‹å‰çš„ä»£ç ï¼Œæ•´çš„éå¸¸æ¼ç«ï¼ï¼





ğŸŒ©ï¸ğŸŒ©ï¸ğŸŒ©ï¸ğŸŒ©ï¸ğŸŒ©ï¸ğŸŒ©ï¸è¿‡äº†ä¸€å‘¨ï¼Œç”Ÿäº§ç¬¬äºŒæ¬¡æš´é›·äº†ï¼Œåˆæœ‰äººåé¦ˆå¯¼å‡ºçš„ç…§ç‰‡æ˜¯å€’ç€çš„äº†ã€‚

ğŸ¤µæœ‰äººè¯´ï¼Œç³»ç»Ÿç•Œé¢ä¸Šçœ‹ç€æ˜¯æ­£çš„ï¼Œå¯¼å‡ºæ¥æ­ªç€çš„ï¼ï¼ï¼ï¼

:question::question::question::question::question::question::question::question::question::question::question::question::question::question::question::question::question::question::question::question:è’™è”½äº†ï¼ï¼

ğŸ¤µæµ‹è¯•äººå‘˜é¡µå¼€å§‹å¤ç°ï¼Œå¤šæ¬¡å¤ç°åï¼Œå‘ç°å¯¼å‡ºé«˜æ¸…çš„å›¾ç‰‡æ‰ä¼šæœ‰é—®é¢˜

:question::question::question::question:

ğŸ¤µå¼€å§‹æ’æŸ¥ä»£ç ï¼~ æˆ‘åœ¨æœ¬åœ°è°ƒè¯•æ‰“æ–­ç‚¹ï¼Œå¥½ä¸å®¹æ˜“è¿½è¸ªåˆ°ä¸‹é¢çš„ä»£ç ç‰‡æ®µã€‚

```java
switch (pictureQualityEnum(picQuality)) {
	case SD: // æ™®æ¸…
		inputStream = pptHandlerManager.getFileHandlerService().getFileAndCompress(fileId, 900, 1200);
		break;
	case HD: // é«˜æ¸…
		inputStream = pptHandlerManager.getFileHandlerService().getFileFromOBS(fileId);
		break;
	default:
		inputStream = pptHandlerManager.getFileHandlerService().getFileAndCompress(fileId, 480, 640);
		break;
}java
```

ç„¶åå¯»æ‰¾getFileAndCompresså’ŒgetFileFromOBSçš„åŒºåˆ«ï¼Œå”¯ä¸€åŒºåˆ«å°±æ˜¯æ™®æ¸…çš„ç…§ç‰‡ä¼šåŠ åä¸ºçš„x-image-processå¤„ç†æ ‡è¯†ï¼Œç„¶åç›´æ¥ä½¿ç”¨getFileFromOBSæ–¹æ³•æ˜¯ç›´æ¥ä»obsä¸‹è½½åŸå§‹ç…§ç‰‡ã€‚

```java
    public InputStream getFileAndCompress(String fileUrl,
                                          Integer width,
                                          Integer height) {
        String compressUrl = "?x-image-process=image/resize,w_%d,h_%d";
        String formatCompressUrl = String.format(compressUrl, width, height);
        String downLoadUrl = fileUrl + formatCompressUrl;
        InputStream fileFromOBS = this.getFileFromOBS(downLoadUrl);
        return fileFromOBS;
    }

	public InputStream getFileFromOBS(String fileUrl) {
        InputStream in = null;
        if (StringUtils.isNotEmpty(fileUrl) && !fileUrl.contains("http")) {
            fileUrl = fileSysProperties.getBaseUrl() + fileUrl;
        }
        try {
            URL url = new URL(fileUrl);
            HttpURLConnection urlCon = (HttpURLConnection) url.openConnection();
            urlCon.setRequestProperty("REFERER", fileSysProperties.getReferer());
            urlCon.setConnectTimeout(15000);
            urlCon.setReadTimeout(15000);
            in = urlCon.getInputStream();
        } catch (IOException e) {
            e.printStackTrace();
            logger.error("è·å–æ–‡ä»¶å¤±è´¥ï¼ï¼š {}", e.getMessage());
        }
        return in;
    }
```



æˆ‘åœ¨æœ¬åœ°è°ƒè¯•æ‰“æ–­ç‚¹ï¼Œå»å°†fileUrlçš„å€¼æ‹·è´å‡ºæ¥ä½¿ç”¨postmanå’Œæµè§ˆå™¨å»è®¿é—®ï¼Œå‘ç°ç»“æœç…§ç‰‡æ˜¯æ­£å¸¸çš„ã€‚

![image-20240923181532886](img/case9/image-20240923181532886.png)



ç„¶ååœ¨æ–­ç‚¹ä½ç½®ï¼Œé€šè¿‡ä¸´æ—¶æ‰§è¡Œä»£ç çš„æ–¹å¼ï¼Œå°†æµçš„å›¾ç‰‡ä¿å­˜åˆ°æœ¬åœ°æ¥çœ‹ï¼Œçœ‹ç…§ç‰‡æ˜¯å¦æ­£ç¡®ï¼Ÿ

```java
try (ByteArrayInputStream in = new ByteArrayInputStream(picture2)) {
    // streamè¯»å…¥image
    BufferedImage image = ImageIO.read(in);
    ImageIO.write(image, "JPG", new File("D:\\aaaa1.jpg"));
}
```

```
    BufferedImage image = ImageIO.read(in);
    ImageIO.write(image, "JPG", new File("D:\\aaaa2.jpg"));
```



ç»“æœï¼Œå‘ç°ï¼Œç»è¿‡è¿™ä¸ªæµä¸‹è½½çš„ç…§ç‰‡ï¼Œç…§ç‰‡å°±æ˜¯å€’ç€çš„ï¼ï¼ï¼ï¼ whatï¼Ÿï¼Ÿ JDKçš„APIæœ‰æ¯›ç—…ï¼Ÿï¼Ÿ

åœ¨æ²¡æœ‰æ˜ç™½ä¸‹é¢æœ‰ä¸ªçŸ¥è¯†ï¼Œæˆ‘å®Œå…¨æ‡µé€¼äº†ï¼~ å–Šäº†å‡ ä¸ªåŒäº‹æ¥çœ‹ç€ç¥å¥‡çš„äº‹æƒ…ï¼Œå¤§å®¶éƒ½è§‰å¾—å¥‡æ€ªï¼Ÿï¼Ÿï¼ï¼

åœ¨å¤šæ¬¡å…¶å®ƒæ–¹æ³•æ— æ³•è§£å†³åï¼Œç»æœ›æ— åŠ©çš„æƒ…å†µä¸‹ï¼Œæˆ‘æ±‚åŠ©äº†**chatGPTï¼Œå®ƒç‚¹é†’äº†æˆ‘**ã€‚

![image-20240923182158164](img/case9/image-20240923182158164.png)



ç„¶åæˆ‘ä½¿ç”¨ä¸‰æ–¹å·¥å…·ï¼Œè¯»å–è¿™ä¸ªåŸå§‹å›¾ç‰‡çš„æ‰€æœ‰TAGä¿¡æ¯æŸ¥çœ‹ã€‚

```xml
        <dependency>
            <groupId>com.drewnoakes</groupId>
            <artifactId>metadata-extractor</artifactId>
            <version>2.13.0</version>
        </dependency>
```

```java
    private static void test2() throws Exception {
//         ExifHelper exifHelper = new ExifHelper("D:\\908e86f7b5ab41388c784e00894938fc.jpg");
         ExifHelper exifHelper = new ExifHelper("D:\\IMG_0475.JPG");
//        ExifHelper exifHelper = new ExifHelper("D:\\IMG_20240919_172852.jpg");
//        ExifHelper exifHelper = new ExifHelper("D:\\aaaa1.jpg");
        HashMap<String, String> allTags = exifHelper.getAllTags();
        for (String tag : allTags.keySet()) {
            System.out.println(tag + ":" + allTags.get(tag));
        }
    }
```



```java
import com.drew.imaging.ImageMetadataReader;
import com.drew.metadata.Directory;
import com.drew.metadata.Metadata;
import com.drew.metadata.Tag;

import java.io.File;
import java.io.InputStream;
import java.util.*;

/**
 * å›¾ç‰‡Exifæ ‡ç­¾å¸®åŠ©ç±»
 * 
 *
 */
public class ExifHelper {
    Metadata metadata = null;
    public ExifHelper(File f) throws Exception {
        metadata = ImageMetadataReader.readMetadata(f);
    }

    public ExifHelper(String path) throws Exception {
        File f = new File(path);
        metadata = ImageMetadataReader.readMetadata(f);
    }

    public ExifHelper(InputStream is) throws Exception {
        metadata = ImageMetadataReader.readMetadata(is);
    }

    /**
     * è·å–Exifä¿¡æ¯æ–‡ä»¶å¤¹
     * 
     * @return
     */
    private Iterable<Directory> getDirectoryList() {
        Iterable<Directory> iterable = metadata.getDirectories();
        return iterable;
    }

    private List<Directory> getDir() {
        List<Directory> lstDir = new ArrayList<Directory>();
        for (Iterator<Directory> iter = getDirectoryList().iterator(); iter
                .hasNext();) {
            Directory dr = iter.next();
            lstDir.add(dr);
        }
        return lstDir;
    }

    /**
     * è·å–Exif Directory å¯¹è±¡ä¸‹çš„ Tag é›†åˆ
     * 
     * @return
     */
    private List<Collection<Tag>> getTars() {
        List<Collection<Tag>> lsttag = new ArrayList<Collection<Tag>>();
        for (Directory d : getDir()) {
            lsttag.add(d.getTags());
        }
        return lsttag;
    }

    /**
     * è·å–ä¸åŒçš„ Exif åˆ†ç±»æ–‡ä»¶å¤¹åç§°
     * 
     * @param type
     * @return
     */
    private String getExifDirectoryName(int type) {
        String directoryName = "File";
        switch (type) {
        case 1:
            directoryName = "Exif SubIFD";
            break;
        case 2:
            directoryName = "Exif IFD0";
            break;
        case 3:
            directoryName = "JFIF";
            break;
        case 4:
            directoryName = "JPEG";
            break;
        case 5:
            directoryName = "File";
        default:
            break;
        }
        return directoryName;
    }

    /**
     * æŒ‡å®šé”®è·å– Exif å…ƒæ•°æ®çš„å±æ€§å€¼.
     * 
     * @param tagKey
     *            Tag é”®åç§°
     * @param type
     *            è·å–ç±»å‹:1.Exif SubIFD; 2.Exif IFD0; 3.JFIF; 4.JPEG; 5.File;
     * @return
     */
    public String getTagByKey(String tagKey, int type) {
        String tagValue = "";
        if (type > 5)
            return tagValue;
        List<Collection<Tag>> lstTag = getTars();
        boolean sgin = true;
        for (Collection<Tag> tagColl : lstTag) {
            if (!sgin)
                break;
            for (Tag tag : tagColl) {
                if (tag.getTagName().equals(tagKey)
                        && tag.getDirectoryName().equals(
                                getExifDirectoryName(type))) {
                    tagValue = tag.getDescription();
                    sgin = false;
                    break;
                }
            }
        }
        return tagValue;
    }

    /**
     * è·å–å›¾ç‰‡çš„æ‰€æœ‰ Exif ä¿¡æ¯.
     * 
     *            è·å–ç±»å‹:1.Exif SubIFD; 2.Exif IFD0; 3.JFIF; 4.JPEG; 5.File;
     * @return
     */
    public HashMap<String, String> getAllTags() {
        HashMap<String, String> map = new HashMap<String, String>();
        List<Collection<Tag>> lstTag = getTars();
        for (Collection<Tag> tagColl : lstTag) {
            for (Tag tag : tagColl) {
                map.put(tag.getTagName(), tag.getDescription());
                // System.out.println(tag.getTagName() + ":" +
                // tag.getDescription() + "[" + tag.getDirectoryName() + "]");
            }
        }
        return map;
    }

    /**
     * è·å– Exif æ—¥æœŸå…ƒæ•°æ®.é€šè¿‡å±æ€§åç§°.
     * 
     * @return
     */
    /*
     * public String getExifDateTime(){ return ""; }
     */
    private String getExifDateTimeByKeyFromHashMap(String key) {
        HashMap<String, String> hash = getAllTags();
        return hash.get(key);
    }

    /**
     * è·å– Exif ç›¸æœºåˆ¶é€ å•†ä¿¡æ¯
     * 
     * @return
     */
    public String getExifMake() {
        String make = "";
        make = getTagByKey("Make", 2);
        return make;
    }

    /**
     * è·å– Exif ç›¸æœºå‹å·ä¿¡æ¯
     * 
     * @return
     */
    public String getExifModel() {
        String model = "";
        model = getTagByKey("Model", 2);
        return model;
    }
}
```



ä¸‹é¢æ˜¯è¿™ä¸ªå›¾ç‰‡çš„è¾“å‡ºå†…å®¹ï¼š

```ini
Lens Model:iPhone 6s Plus back camera 4.15mm f/2.2
Unknown tag (0x0006):162
Compression:JPEG (old-style)
Number of Tables:4 Huffman tables
Exif Version:2.32
Components Configuration:YCbCr
Compression Type:Baseline
Host Computer:iPhone 6s Plus
Number of Components:3
Component 2:Cb component: Quantization table 1, Sampling factors 1 horiz/1 vert
Focal Length:4.2 mm
Component 1:Y component: Quantization table 0, Sampling factors 2 horiz/2 vert
YCbCr Positioning:Center of pixel array
Sub-Sec Time Digitized:592
Date/Time Original:2024:09:19 16:01:18
Shutter Speed Value:1/16 sec
Unknown tag (0x000c):49/256 27/128
X Resolution:72 dots per inch
Brightness Value:1.35
Component 3:Cr component: Quantization table 1, Sampling factors 1 horiz/1 vert
Offset Time Digitized:+08:00
F-Number:f/2.2
Focal Length 35:29 mm
Unknown tag (0x0010):1
Exposure Program:Program normal
Unknown tag (0x0002):[558 values]
Unknown tag (0x0014):5
Unknown tag (0x0026):0
Unknown tag (0x0017):0
Unknown tag (0x0009):4627
Detected File Type Long Name:Joint Photographic Experts Group
Exposure Time:1/17 sec
Detected MIME Type:image/jpeg
Expected File Name Extension:jpg
ISO Speed Ratings:125
Subject Location:2015 1511 2217 1330
Make:Apple
Unknown tag (0x002b):25DA31BB-A170-4C24-8A01-7AD3D6387E6C
Orientation:Right side, top (Rotate 90 CW)
Metering Mode:Multi-segment
Unknown tag (0x002f):98
Thumbnail Offset:2146 bytes
Lens Specification:4.15mm f/2.2
Software:14.4.2
Exif Image Height:3024 pixels
Unknown tag (0x0001):12
Unknown tag (0x0025):0
Y Resolution:72 dots per inch
Unknown tag (0x0005):156
Scene Type:Directly photographed image
Unknown tag (0x0008):5789/118751 -47377/65075 -21679/33444
FlashPix Version:1.00
Data Precision:8 bits
Sub-Sec Time Original:592
Offset Time:+08:00
Unknown tag (0x003c):0
Sensing Method:One-chip color area sensor
Unknown tag (0x001c):3
Unknown tag (0x000e):0
Unknown tag (0x000f):2
Thumbnail Length:8698 bytes
Color Space:sRGB
Offset Time Original:+08:00
File Size:1915652 bytes
Unknown tag (0x0020):98C384B8-9865-4E36-89B9-7A82F12C8857
Date/Time Digitized:2024:09:19 16:01:18
File Name:IMG_0475.JPG
Flash:Flash did not fire, auto
Unknown tag (0x0036):150
Unknown tag (0x0004):1
Aperture Value:f/2.2
Unknown tag (0x0007):1
Unknown tag (0x0019):0
File Modified Date:æ˜ŸæœŸå›› ä¹æœˆ 19 17:57:10 +08:00 2024
Date/Time:2024:09:19 16:01:18
Lens Make:Apple
Unknown tag (0x003b):0
Exif Image Width:4032 pixels
Image Height:3024 pixels
Unknown tag (0x000d):20
Image Width:4032 pixels
Unknown tag (0x001f):0
Resolution Unit:Inch
Exposure Bias Value:0 EV
Detected File Type Name:JPEG
Exposure Mode:Auto exposure
Model:iPhone 6s Plus
Scene Capture Type:Standard
Unknown tag (0x0011):FE2DF3B8-D988-4E59-BB46-BB3533747997
Run Time:[104 values]
White Balance Mode:Auto white balance
Unknown tag (0x0027):0
```

è¿™é‡Œé¢æœ‰å‡ ä¸ªä¿¡æ¯éå¸¸é‡è¦ï¼š

Lens Make:Apple

Orientation:Right side, top (Rotate 90 CW)

**ç¿»è¯‘ï¼š è‹¹æœæ‰‹æœºï¼  å›¾ç‰‡æ—‹è½¬90åº¦ï¼**

æˆ‘ä»¬åœ¨çœ‹çœ‹æˆ‘ä»¬çš„å¯¼å‡ºä»£ç çš„getFileFromOBSæ–¹æ³•å¯¼å‡ºçš„ç…§ç‰‡çš„TAGä¿¡æ¯ï¼š

```ini
Resolution Units:none
Number of Tables:4 Huffman tables
Detected File Type Long Name:Joint Photographic Experts Group
File Modified Date:æ˜ŸæœŸä¸€ ä¹æœˆ 23 17:00:25 +08:00 2024
Compression Type:Baseline
Data Precision:8 bits
Detected MIME Type:image/jpeg
Expected File Name Extension:jpg
Number of Components:3
Component 2:Cb component: Quantization table 1, Sampling factors 1 horiz/1 vert
Thumbnail Height Pixels:0
Component 1:Y component: Quantization table 0, Sampling factors 2 horiz/2 vert
Image Height:1080 pixels
Thumbnail Width Pixels:0
X Resolution:1 dot
Image Width:1440 pixels
File Size:126904 bytes
Component 3:Cr component: Quantization table 1, Sampling factors 1 horiz/1 vert
Version:1.2
Detected File Type Name:JPEG
File Name:aaaa1.jpg
Y Resolution:1 dot
```

TAGå†…å®¹å¾ˆå°‘ï¼Œä¸Šé¢çš„â€œè‹¹æœæ‰‹æœºï¼  å›¾ç‰‡æ—‹è½¬90åº¦ï¼â€çš„TAGæ ‡ç­¾ä¿¡æ¯é¡µæ²¡æœ‰äº†ï¼ æ‰€ä»¥æˆ‘ä»¬çœ‹åˆ°çš„ç…§ç‰‡æ˜¯å€’ç€çš„ã€‚



å¦å¤–ï¼Œwindowsçš„æ–‡ä»¶è¯¦ç»†ä¿¡æ¯ï¼Œåªèƒ½çœ‹åˆ°éƒ¨åˆ†çš„TAGä¿¡æ¯ï¼Œä¸èƒ½çœ‹åˆ°è¿™ä¸ªâ€œ  å›¾ç‰‡æ—‹è½¬90åº¦ï¼â€çš„TAGæ ‡ç­¾ä¿¡æ¯ï¼Œåªèƒ½çœ‹åˆ°æ˜¯è‹¹æœæ‰‹æœºæ‹ç…§çš„ã€‚

![image-20240923183753339](img/case9/image-20240923183753339.png)

## ç»“è®º



> ç»“è®ºï¼šé€šè¿‡é€šè¿‡çš„javaæµå»å¤„ç†å›¾ç‰‡æµä¿¡æ¯ï¼Œä¼šä¸¢å¤±å›¾ç‰‡çš„TAGä¿¡æ¯ï¼Œå¯¼è‡´æ—‹è½¬å±æ€§Orientation:Right side, top (Rotate 90 CW)æœªç”Ÿæ•ˆï¼Œæ‰€ä»¥å¯¼å‡ºçš„æŠ¥å‘Šä¸­çš„å›¾ç‰‡æ˜¯å€’ç€çš„ã€‚

## é—®é¢˜æ‰¾åˆ°äº†ï¼Œé‚£æ€ä¹ˆå¤„ç†è¿™ä¸ªé—®é¢˜ï¼Ÿ

ç°åœ¨æˆ‘èƒ½é€šè¿‡ä¸‰æ–¹å·¥å…·è¯»å–åˆ°è¿™ä¸ªå›¾ç‰‡æ˜¯å¦éœ€è¦æ—‹è½¬ï¼Œéš¾é“æˆ‘åœ¨è‡ªå·±ä»£ç é‡Œé¢å‘ç°éœ€è¦æ—‹è½¬è‡ªå·±æ¥æ—‹è½¬ï¼Ÿ

åæ¥é€šè¿‡å‘ç°ï¼Œåä¸ºçš„x-image-processï¼Œèƒ½è‡ªåŠ¨å¤„ç†è¿™ä¸ªtagå±æ€§ä¿¡æ¯ã€‚é‚£æˆ‘å°±å¯ä»¥å€ŸåŠ©åä¸ºæä¾›çš„è¿™ä¸ªå·¥å…·ï¼Œè‡ªåŠ¨è½¬æ­£è¿™ä¸ªç…§ç‰‡ã€‚å¯¼å‡ºé«˜æ¸…æ˜¯å§ï¼Œæˆ‘è´¨é‡è®¾ç½®100å°±å¯ä»¥äº†å‘—

https://zhl-rm-test.obs.cn-east-2.myhuaweicloud.com/908e86f7b5ab41388c784e00894938fc.jpg?x-image-process=image/quality,q_100

ä»getFileFromOBSåŸºç¡€ä¸Šï¼ŒåŠ ä¸ªé‡è½½çš„å£³ä»£ç ï¼š

```java
/**
     * è¿™é‡Œå¤‡æ³¨ä¸€ä¸ªç”Ÿäº§é—®é¢˜ï¼šä¸ºä»€ä¹ˆè¿™é‡Œè¦ä»getFileFromOBSåŸºç¡€ä¸ŠæŠ½å‡ºä¸€ä¸ªgetHDFileæ–¹æ³•
     * appleæ‰‹æœºæ‹ç…§å­˜åœ¨æ‹ç…§çš„ç…§ç‰‡æ˜¯å€’ç€çš„ï¼Œæ˜¯é€šè¿‡å›¾ç‰‡çš„tagå±æ€§è½¬æ­£çš„ã€‚
     *  Orientation:Right side, top (Rotate 90 CW)
     *  å¦‚æœæ˜¯ç”¨javaæµç›´æ¥å»è¯»å–è¿™ä¸ªå›¾ç‰‡ï¼Œå›¾ç‰‡çš„tagå±æ€§ä¼šä¸¢å¤±ï¼Œå¯¼è‡´ä¸‹è½½çš„ä¸ŠåˆŠæŠ¥å‘Šä¸­è¿‡çš„å›¾ç‰‡æ˜¯å€’ç€çš„ã€‚
     *
     *  é‚£ä¸ºä»€ä¹ˆæµè§ˆå™¨å’Œpostmanå»è®¿é—®è¿™ä¸ªåœ°å€ï¼Œå›¾ç‰‡åˆæ˜¯æ­£ç€çš„å‘¢ï¼Ÿ
     *  https://zhl-rm-test.obs.cn-east-2.myhuaweicloud.com/908e86f7b5ab41388c784e00894938fc.jpg
     *  åŸå› æ˜¯å› ä¸ºæµè§ˆå™¨å’Œpostmanä¼šå»è¯»å–è¿™ä¸ªå›¾ç‰‡çš„tagå±æ€§ä¿¡æ¯ï¼Œä¼šæ—‹è½¬åˆ°æ­£ç¡®çš„è§’åº¦ã€‚
     *
     *  å¦‚æœç›´æ¥ä½¿ç”¨getFileFromOBSæ–¹æ³•ï¼Œä¸‹è½½çš„å›¾ç‰‡å°±æ˜¯å€’ç€çš„ã€‚
     *
     *  è§£å†³åŠæ³•ï¼š
     *      åä¸ºçš„å›¾ç‰‡å¤„ç†å™¨x-image-processï¼Œä¼šå»è¯»å–è¿™ä¸ªå±æ€§ä¿¡æ¯ï¼Œè‡ªåŠ¨è°ƒæ•´ä¸ºæ­£ç¡®çš„è§’åº¦ï¼Œä¸‹è½½ä¸‹æ¥å°±ä¸æ˜¯å€’ç€çš„ç…§ç‰‡ã€‚
     *
     * @param fileUrl æ–‡ä»¶url
     * @return
     */
    public InputStream getHDFile(String fileUrl) {
        return getFileFromOBS(fileUrl + "?x-image-process=image/quality,q_100");
    }
```



<center><font color="green" size="40">å®Œç¾ï¼æ”¶å·¥ï¼</font></center>

## åæ€è¿™ä¸ªé—®é¢˜

- å¦‚æœè¿™ä¸ªåŠŸèƒ½æ˜¯åœ¨ä¸€äº›ç‰¹åˆ«å…³é”®çš„ç³»ç»Ÿä¸Šï¼Œå¦‚æœå‘ç”Ÿå¤§çš„é—®é¢˜ï¼Œå¯¹å…¬å¸é€ æˆäº†å·¨å¤§æŸå¤±ï¼Œå°±GGäº†ï¼Œè¿˜å¥½è‡³å°‘æ™®é€šåŠŸèƒ½ï¼›
- è¯´å®åœ¨è¯ï¼Œæ²¡é‡åˆ°è¿‡è¿™ä¸ªé—®é¢˜çš„äººï¼Œæˆ‘ä»¬éƒ¨é—¨çš„äººè‚¯å®šå…¨éƒ¨éƒ½è¦è¸©è¿™ä¸ªå‘ï¼è€Œä¸”å¾ˆå¯èƒ½å¾ˆä¹…éƒ½æ‰¾ä¸å‡ºæ¥ã€‚è™½ç„¶è¿™ä¸ªä»£ç ä¸æ˜¯æˆ‘å†™çš„ï¼Œæˆ‘æ¥å†™ä¸€ä¼šçŠ¯è¿™ä¸ªé”™è¯¯ï¼ï¼
- è¿™æ¬¡æ’é”™ï¼Œå¦‚æœä¸æ˜¯chatGPTæé†’äº†æˆ‘ï¼Œæˆ‘å¯èƒ½è¿˜è¦åœ¨ä¸Šé¢æ‡µé€¼å¾ˆä¹…ï¼~æ„Ÿè°¢chatGPTï¼Œæœ‰æ—¶å€™ä¸€ä¸ªè§£å†³é—®é¢˜æ€è·¯ä¸è¡Œï¼Œå¯ä»¥å°è¯•ä¸‹å…¶å®ƒæ€è·¯ã€‚
- æ²¡æœ‰é‡åˆ°è¿‡è¿™ä¸ªé—®é¢˜ï¼Œæµ‹è¯•äººå‘˜ä¹Ÿä¸èƒ½æƒ³åˆ°è¿™æ ·çš„æµ‹è¯•æ¡ˆä¾‹ï¼Œä¸ä¼šæƒ³åˆ°iosçš„ç…§ç‰‡åœ¨å¯¼å‡ºä¸ŠåˆŠæŠ¥å‘Šçš„æ—¶å€™ä¼šæœ‰é—®é¢˜ï¼ï¼
- è¿™ä¸ªé—®é¢˜ï¼Œé™¤éæœ‰ç›¸å…³ç»éªŒï¼Œä¸ç„¶éƒ½å¾—æ ½ï¼ï¼ï¼



## å…¨éƒ¨çš„è°ƒè¯•ä»£ç ï¼š

```java
package com.minibyte.test;

import org.apache.commons.lang3.StringUtils;

import javax.imageio.ImageIO;
import java.awt.image.BufferedImage;
import java.io.File;
import java.io.FileInputStream;
import java.io.IOException;
import java.io.InputStream;
import java.net.HttpURLConnection;
import java.net.URL;
import java.util.HashMap;

public class Test1 {
    public static void main(String[] args) throws Exception {
//        test1();
        test2();
//        test3();

//        FileInputStream fileInputStream = new FileInputStream(new File("D:\\IMG_0475.JPG"));
//        BufferedImage image = ImageIO.read(fileInputStream);
//        ImageIO.write(image, "JPG", new File("D:\\aaaa7.jpg"));
    }
    private static void test1() throws IOException {
        InputStream fileFromOBS = getFileFromOBS("908e86f7b5ab41388c784e00894938fc.jpg");
        BufferedImage image = ImageIO.read(fileFromOBS);
        ImageIO.write(image, "JPG", new File("D:\\aaaa1.jpg"));
    }

    private static void test3() throws IOException {
        InputStream fileFromOBS = getFileFromOBS("908e86f7b5ab41388c784e00894938fc.jpg?x-image-process=image/quality,q_100");
        BufferedImage image = ImageIO.read(fileFromOBS);
        ImageIO.write(image, "JPG", new File("D:\\aaaa4.jpg"));

    }

    private static void test2() throws Exception {
//         ExifHelper exifHelper = new ExifHelper("D:\\908e86f7b5ab41388c784e00894938fc.jpg");
//         ExifHelper exifHelper = new ExifHelper("D:\\IMG_0475.JPG");
//        ExifHelper exifHelper = new ExifHelper("D:\\IMG_20240919_172852.jpg");
        ExifHelper exifHelper = new ExifHelper("D:\\aaaa1.jpg");
        HashMap<String, String> allTags = exifHelper.getAllTags();
        for (String tag : allTags.keySet()) {
            System.out.println(tag + ":" + allTags.get(tag));
        }
    }


    public static InputStream getFileFromOBS(String fileUrl) {
        InputStream in = null;
        if (StringUtils.isNotEmpty(fileUrl) && !fileUrl.contains("http")) {
            fileUrl = "https://zhl-rm-test.obs.cn-east-2.myhuaweicloud.com/" + fileUrl;
        }
        try {
            System.out.println(fileUrl);
            URL url = new URL(fileUrl);
            HttpURLConnection urlCon = (HttpURLConnection) url.openConnection();
            urlCon.setRequestProperty("REFERER", "www.xinchao.com");
            urlCon.setConnectTimeout(15000);
            urlCon.setReadTimeout(15000);
            in = urlCon.getInputStream();
        } catch (IOException e) {
            e.printStackTrace();
        }
        return in;
    }
}
```



## åç»­

ä¸Šé¢å¾—ç…§ç‰‡æ˜¯è‹¹æœæ‰‹æœºç«–ç€æ‹çš„ï¼Œæˆ‘ä»¬å–Šæµ‹è¯•æ¨ªç€æ’äº†ä¸€å¼ çœ‹äº†ä¸‹TAGä¿¡æ¯åŒºåˆ«ï¼

![image-20240923195626383](img/case9/image-20240923195626383.png)
