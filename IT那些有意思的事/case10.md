# 为什么放假一段时间后，业务操作变慢了



## 回忆

记得，我们在做一个统一数据源的版本，当时我们做了大量的自测冒烟，并没有感觉调度业务慢，当提测后，突然测试人员反馈调度业务特别慢！

有好几个小伙伴一起参与到了问题的排查中，排查了很久，也做了些优化，当时提升并不明显。

后来定位到调度会多次从交付平台去调用ssp去查询点位，从日志上分析出ssp的响应比较慢，然后ssp相关开发人员开始排查，怀疑是sql的问题，他们从日志的sql拿到IDEA的查数据库的工具查询，结果发现很快，他们认为是项目数据库驱动底层的问题，后来架构师下场，说这是因为工具的原因，因为有很多工具查询的时候会给你查询内容进行内容分页，所以你觉得sql很快，如果你用老版本的navicate就会觉得慢。

然后交互端开发人员提议，为相关业务提供较为纯粹的查询接口，只查询相关内容就可以了，然后ssp新开了接口，弄到测试环境后，发现速度依然没有提升起来（后面即将相关代码删除了，还是用的老接口）。

架构师他又来了，开始分析处理这个问题，给查询sql加索引，调整多表查询连接表的顺序，然而速度快了一点点，但是仍然感觉很慢。

再后来，一个项目负责人，突然想去看华为云上的数据库实例的情况，看看硬件资源等信息，发现数据库实例的CPU长时间一直几乎打满的状态运行，好吧，终于找到问题了，找到运维，切了实例后，相应业务速度恢复，加上中途的折腾，比以前更快了。

当天晚上加班赶进度的时候，运维准备下班从我们这里走过，和运维聊了几句，运维提到了可能是因为大数据那边在拉数据。

哦哦，原来如此，大数据有那边的人没有考虑大多，直接对ssp的库进行拉数据，导致ssp的数据库性能极具下降，所以才出现这几天突然性能变慢的情况。



## 总结：

- 对于数据库这层的优化，不仅仅是对表加索引，让查询sql走索引，还要考虑数据库硬件配置情况、性能消耗情况、表数据量情况、是否分表等等。
- 新一代查询数据库工具，会自动为查询语句添加分页。
- 如果遇到要去连别人数据库的情况，一定要告知对方，评估数据库压力等情况，避免造成类似的情况。





